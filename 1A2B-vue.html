<!DOCTYPE html>
<html lang="zh-Hant">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>çŒœæ•¸å­—éŠæˆ² (1A2B) - Vue.js ç‰ˆ</title>
		<!-- Bootstrap CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<!-- Vue 3 CDN -->
		<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
		<style>
			body {
				font-family: "Microsoft JhengHei", system-ui, -apple-system, Segoe UI,
					Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji",
					"Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
				background-color: #f3f4f6;
			}
		</style>
	</head>
	<body>
		<div id="app">
			<div class="container py-5">
				<h1 class="h3 text-primary text-center mb-4">
					çŒœæ•¸å­—éŠæˆ² (1A2B) - Vue.js ç‰ˆ
				</h1>
				<div class="row g-4">
					<!-- å·¦å´ï¼šæ“ä½œå€ -->
					<div class="col-12 col-lg-6">
						<div class="card shadow-sm h-100">
							<div class="card-body">
								<h2 class="h5 text-secondary mb-3">æ“ä½œé¢æ¿</h2>

								<div class="mb-3">
									<label for="guessInput" class="form-label"
										>è«‹è¼¸å…¥ 4 ä½ä¸é‡è¤‡æ•¸å­—</label
									>
									<input
										type="text"
										id="guessInput"
										v-model="guess"
										@keydown.enter="doGuess"
										@input="filterInput"
										class="form-control"
										placeholder="ä¾‹å¦‚ï¼š1234"
										inputmode="numeric"
										maxlength="4"
										ref="guessInput"
									/>
								</div>

								<div class="mb-2">
									<label class="form-label">æ•¸å­—æŒ‰éˆ•</label>
									<div class="row g-2">
										<div
											v-for="digit in keypadDigits"
											:key="digit"
											class="col-4"
										>
											<button
												type="button"
												:disabled="isDigitDisabled(digit)"
												@click="addDigit(digit)"
												class="btn btn-outline-secondary w-100"
											>
												{{ digit }}
											</button>
										</div>
										<div class="col-4">
											<button
												type="button"
												@click="backspace"
												class="btn btn-outline-danger w-100"
											>
												âŒ«
											</button>
										</div>
										<div class="col-4">
											<button
												type="button"
												@click="addDigit('0')"
												:disabled="isDigitDisabled('0')"
												class="btn btn-outline-secondary w-100"
											>
												0
											</button>
										</div>
										<div class="col-4">
											<button
												type="button"
												@click="clearInput"
												class="btn btn-outline-warning w-100"
											>
												æ¸…é™¤
											</button>
										</div>
									</div>
									<small class="text-muted"
										>é»é¸æ•¸å­—ä¾†è¼¸å…¥ï¼Œå·²ä½¿ç”¨æˆ–è¶…é 4
										ä½æ•¸æ™‚æœƒè‡ªå‹•åœç”¨æŒ‰éˆ•ã€‚</small
									>
								</div>

								<div class="d-flex justify-content-center gap-2 flex-wrap">
									<button
										@click="doGuess"
										type="button"
										class="btn btn-primary"
									>
										çŒœï¼
									</button>
									<button
										@click="startNewGame"
										type="button"
										class="btn btn-success"
									>
										é‡æ–°é–‹å§‹
									</button>
									<button
										@click="showAnswer"
										type="button"
										class="btn btn-warning"
									>
										é¡¯ç¤ºç­”æ¡ˆï¼ˆæ¸¬è©¦ï¼‰
									</button>
								</div>
								<div
									:class="`alert alert-${resultType} mt-3 mb-0`"
									role="alert"
								>
									{{ resultText }}
								</div>
							</div>
						</div>
					</div>

					<!-- å³å´ï¼šæ­·ç¨‹ç´€éŒ„ -->
					<div class="col-12 col-lg-6">
						<div class="card shadow-sm h-100">
							<div class="card-body d-flex flex-column">
								<h2 class="h5 text-secondary mb-3">
									æ­·ç¨‹ç´€éŒ„ ({{ history.length }} æ¬¡)
								</h2>
								<ul
									class="list-group flex-grow-1"
									style="max-height: 420px; overflow-y: auto"
								>
									<li
										v-if="history.length === 0"
										class="list-group-item text-muted text-center"
									>
										å°šæœªé–‹å§‹çŒœæ¸¬
									</li>
									<li
										v-for="(record, index) in history"
										:key="index"
										class="list-group-item"
										:class="{ 'list-group-item-success': record.result === '4A0B' }"
									>
										ç¬¬ {{ record.attempt }} æ¬¡ï¼š{{ record.guess }} â†’ {{
										record.result }}
									</li>
								</ul>
								<div class="mt-3 small text-muted">
									é¡¯ç¤ºæ¯æ¬¡çŒœæ¸¬çš„çµæœï¼ˆæ ¼å¼ï¼šç¬¬ N æ¬¡ï¼šçŒœæ¸¬ â†’ å¹¾ A å¹¾
									Bï¼‰ã€‚ç­”å°æ™‚æœƒä»¥ç¶ è‰²æ¨™ç¤ºã€‚
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			const { createApp } = Vue;

			createApp({
				data() {
					return {
						guess: "",
						resultText: "è«‹é–‹å§‹çŒœï¼",
						resultType: "info",
						attempts: 0,
						answer: "",
						history: [],
						keypadDigits: ["1", "2", "3", "4", "5", "6", "7", "8", "9"],
					};
				},

				computed: {
					isValidGuess() {
						return (
							this.guess.length === 4 &&
							/^\d+$/.test(this.guess) &&
							new Set(this.guess).size === 4
						);
					},
				},

				methods: {
					// ç”¢ç”Ÿä¸é‡è¤‡å››ä½æ•¸å­—
					generateAnswer() {
						let digits = [];
						while (digits.length < 4) {
							let d = Math.floor(Math.random() * 10).toString();
							if (!digits.includes(d)) digits.push(d);
						}
						return digits.join("");
					},

					// é–‹å§‹æ–°éŠæˆ²
					startNewGame() {
						this.answer = this.generateAnswer();
						this.attempts = 0;
						this.history = [];
						this.resultText = "å·²ç”¢ç”Ÿæ–°é¡Œç›®ï¼Œè«‹é–‹å§‹çŒœï¼";
						this.resultType = "info";
						this.guess = "";
						console.log("DEBUG ç­”æ¡ˆ:", this.answer); // å¯ç§»é™¤
					},

					// æ¯”å°çŒœæ¸¬çµæœ
					checkGuess(answer, guess) {
						let A = 0,
							B = 0;
						for (let i = 0; i < 4; i++) {
							if (guess[i] === answer[i]) A++;
							else if (answer.includes(guess[i])) B++;
						}
						return `${A}A${B}B`;
					},

					// åŸ·è¡ŒçŒœæ¸¬
					doGuess() {
						if (!this.isValidGuess) {
							this.setResult("âŒ è«‹è¼¸å…¥4ä½ä¸é‡è¤‡çš„æ•¸å­—ï¼", "danger");
							return;
						}

						this.attempts++;
						const result = this.checkGuess(this.answer, this.guess);

						// åŠ å…¥æ­·å²è¨˜éŒ„
						this.history.push({
							attempt: this.attempts,
							guess: this.guess,
							result: result,
						});

						if (result === "4A0B") {
							this.setResult(
								`ğŸ‰ æ­å–œç­”å°ï¼å…±çŒœäº† ${this.attempts} æ¬¡ï¼`,
								"success"
							);
							alert(
								`ç­”å°äº†ï¼ç­”æ¡ˆæ˜¯ ${this.answer}\nç¸½å…±çŒœäº† ${this.attempts} æ¬¡ã€‚`
							);
						} else {
							this.setResult(`çµæœï¼š${result}`, "secondary");
						}

						this.guess = "";
						this.$nextTick(() => {
							this.$refs.guessInput.focus();
						});
					},

					// è¨­å®šçµæœè¨Šæ¯
					setResult(message, type = "info") {
						this.resultText = message;
						this.resultType = type;
					},

					// æ•¸å­—æŒ‰éˆ•æ˜¯å¦åœç”¨
					isDigitDisabled(digit) {
						return this.guess.includes(digit) || this.guess.length >= 4;
					},

					// æ–°å¢æ•¸å­—
					addDigit(digit) {
						if (this.guess.length >= 4 || this.guess.includes(digit)) return;
						this.guess += digit;
						this.$nextTick(() => {
							this.$refs.guessInput.focus();
						});
					},

					// é€€æ ¼
					backspace() {
						this.guess = this.guess.slice(0, -1);
						this.$nextTick(() => {
							this.$refs.guessInput.focus();
						});
					},

					// æ¸…é™¤è¼¸å…¥
					clearInput() {
						this.guess = "";
						this.$nextTick(() => {
							this.$refs.guessInput.focus();
						});
					},

					// éæ¿¾è¼¸å…¥ï¼ˆåƒ…ä¿ç•™æ•¸å­—ï¼Œé™åˆ¶é•·åº¦ï¼‰
					filterInput() {
						const digitsOnly = this.guess.replace(/[^\d]/g, "");
						this.guess = digitsOnly.slice(0, 4);
					},

					// é¡¯ç¤ºç­”æ¡ˆï¼ˆæ¸¬è©¦ç”¨ï¼‰
					showAnswer() {
						alert(`ç›®å‰çš„ç­”æ¡ˆæ˜¯ï¼š${this.answer}`);
					},
				},

				mounted() {
					this.startNewGame();
					// è‡ªå‹•èšç„¦åˆ°è¼¸å…¥æ¡†
					this.$nextTick(() => {
						this.$refs.guessInput.focus();
					});
				},
			}).mount("#app");
		</script>

		<!-- Bootstrap JS (åŒ…å« Popper) -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
