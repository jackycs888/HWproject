<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çŒœæ•¸å­—éŠæˆ² (1A2B)</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { font-family: "Microsoft JhengHei", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; background-color: #f3f4f6; }
  </style>
</head>
<body>

  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-5">
        <div class="card shadow-sm">
          <div class="card-body">
            <h1 class="h3 text-primary text-center mb-4">çŒœæ•¸å­—éŠæˆ² (1A2B)</h1>

            <div class="mb-3">
              <label for="guessInput" class="form-label">è«‹è¼¸å…¥ 4 ä½ä¸é‡è¤‡æ•¸å­—</label>
              <input type="text" id="guessInput" class="form-control" placeholder="ä¾‹å¦‚ï¼š1234" inputmode="numeric" maxlength="4">
            </div>

            <div class="mb-2">
              <label class="form-label">æ•¸å­—æŒ‰éˆ•</label>
              <div id="keypad" class="row g-2">
                <div class="col-4"><button type="button" class="btn btn-outline-secondary w-100" data-digit="1">1</button></div>
                <div class="col-4"><button type="button" class="btn btn-outline-secondary w-100" data-digit="2">2</button></div>
                <div class="col-4"><button type="button" class="btn btn-outline-secondary w-100" data-digit="3">3</button></div>
                <div class="col-4"><button type="button" class="btn btn-outline-secondary w-100" data-digit="4">4</button></div>
                <div class="col-4"><button type="button" class="btn btn-outline-secondary w-100" data-digit="5">5</button></div>
                <div class="col-4"><button type="button" class="btn btn-outline-secondary w-100" data-digit="6">6</button></div>
                <div class="col-4"><button type="button" class="btn btn-outline-secondary w-100" data-digit="7">7</button></div>
                <div class="col-4"><button type="button" class="btn btn-outline-secondary w-100" data-digit="8">8</button></div>
                <div class="col-4"><button type="button" class="btn btn-outline-secondary w-100" data-digit="9">9</button></div>
                <div class="col-4"><button type="button" id="btnBackspace" class="btn btn-outline-danger w-100">âŒ«</button></div>
                <div class="col-4"><button type="button" class="btn btn-outline-secondary w-100" data-digit="0">0</button></div>
                <div class="col-4"><button type="button" id="btnClear" class="btn btn-outline-warning w-100">æ¸…é™¤</button></div>
              </div>
              <small class="text-muted">é»é¸æ•¸å­—ä¾†è¼¸å…¥ï¼Œå·²ä½¿ç”¨æˆ–è¶…é 4 ä½æ•¸æ™‚æœƒè‡ªå‹•åœç”¨æŒ‰éˆ•ã€‚</small>
            </div>

            <div class="d-flex justify-content-center gap-2 flex-wrap">
              <button id="btnGuess" type="button" class="btn btn-primary">çŒœï¼</button>
              <button id="btnRestart" type="button" class="btn btn-success">é‡æ–°é–‹å§‹</button>
              <button id="btnShowAnswer" type="button" class="btn btn-warning">é¡¯ç¤ºç­”æ¡ˆï¼ˆæ¸¬è©¦ï¼‰</button>
            </div>

            <div id="result" class="alert alert-info mt-3 mb-0" role="alert">è«‹é–‹å§‹çŒœï¼</div>

            <ul id="history" class="list-group mt-3" style="max-height: 220px; overflow-y: auto;"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let answer = "";
    let attempts = 0;

    // åˆå§‹åŒ–
    function startNewGame() {
      answer = generateAnswer();
      attempts = 0;
      document.getElementById("history").innerHTML = "";
      document.getElementById("result").textContent = "å·²ç”¢ç”Ÿæ–°é¡Œç›®ï¼Œè«‹é–‹å§‹çŒœï¼";
      document.getElementById("guessInput").value = "";
      console.log("DEBUG ç­”æ¡ˆ:", answer); // å¯ç§»é™¤
    }

    // ç”¢ç”Ÿä¸é‡è¤‡å››ä½æ•¸å­—
    function generateAnswer() {
      let digits = [];
      while (digits.length < 4) {
        let d = Math.floor(Math.random() * 10).toString();
        if (!digits.includes(d)) digits.push(d);
      }
      return digits.join("");
    }

    // æª¢æŸ¥è¼¸å…¥æ˜¯å¦åˆæ³•
    function isValidGuess(guess) {
      if (guess.length !== 4) return false;
      if (!/^\d+$/.test(guess)) return false;
      return new Set(guess).size === 4;
    }

    // æ¯”å°çŒœæ¸¬çµæœ
    function checkGuess(answer, guess) {
      let A = 0, B = 0;
      for (let i = 0; i < 4; i++) {
        if (guess[i] === answer[i]) A++;
        else if (answer.includes(guess[i])) B++;
      }
      return `${A}A${B}B`;
    }

    // æ›´æ–°æ•¸å­—éµç›¤å¯ç”¨ç‹€æ…‹
    function updateKeypad() {
      const inputEl = document.getElementById("guessInput");
      const val = inputEl.value;
      const len = val.length;
      document.querySelectorAll('#keypad [data-digit]').forEach(btn => {
        const d = btn.getAttribute('data-digit');
        btn.disabled = val.includes(d) || len >= 4;
      });
    }

    function setResult(message, type = "info") {
      const resultEl = document.getElementById("result");
      resultEl.textContent = message;
      resultEl.className = `alert alert-${type} mt-3 mb-0`;
    }

    function doGuess() {
      const inputEl = document.getElementById("guessInput");
      const guess = inputEl.value.trim();

      if (!isValidGuess(guess)) {
        setResult("âŒ è«‹è¼¸å…¥4ä½ä¸é‡è¤‡çš„æ•¸å­—ï¼", "danger");
        return;
      }

      attempts++;
      const result = checkGuess(answer, guess);

      const li = document.createElement("li");
      li.className = "list-group-item";
      li.textContent = `ç¬¬ ${attempts} æ¬¡ï¼š${guess} â†’ ${result}`;
      document.getElementById("history").appendChild(li);

      if (result === "4A0B") {
        setResult(`ğŸ‰ æ­å–œç­”å°ï¼å…±çŒœäº† ${attempts} æ¬¡ï¼`, "success");
        alert(`ç­”å°äº†ï¼ç­”æ¡ˆæ˜¯ ${answer}\nç¸½å…±çŒœäº† ${attempts} æ¬¡ã€‚`);
      } else {
        setResult(`çµæœï¼š${result}`, "secondary");
      }

      inputEl.value = "";
      inputEl.focus();
      updateKeypad();
    }

    // çŒœæŒ‰éˆ•äº‹ä»¶
    document.getElementById("btnGuess").addEventListener("click", doGuess);

    // è¼¸å…¥æ¡† Enter ä¹Ÿå¯è§¸ç™¼
    document.getElementById("guessInput").addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        doGuess();
      }
    });

    // è¼¸å…¥æ¡†å…§å®¹è®Šæ›´æ™‚ï¼ŒåŒæ­¥æ›´æ–°éµç›¤ç‹€æ…‹ï¼ˆåƒ…ä¿ç•™æ•¸å­—ï¼Œé™åˆ¶é•·åº¦ï¼‰
    document.getElementById("guessInput").addEventListener("input", function() {
      const digitsOnly = this.value.replace(/[^\d]/g, "");
      this.value = digitsOnly.slice(0, 4);
      updateKeypad();
    });

    // é‡æ–°é–‹å§‹æŒ‰éˆ•
    document.getElementById("btnRestart").addEventListener("click", startNewGame);

    // é¡¯ç¤ºç­”æ¡ˆæŒ‰éˆ•ï¼ˆæ¸¬è©¦ç”¨ï¼‰
    document.getElementById("btnShowAnswer").addEventListener("click", function() {
      alert(`ç›®å‰çš„ç­”æ¡ˆæ˜¯ï¼š${answer}`);
    });

    // æ•¸å­—éµç›¤äº‹ä»¶å§”æ´¾
    document.getElementById("keypad").addEventListener("click", function(e) {
      const btn = e.target.closest('button[data-digit]');
      if (!btn) return;
      const inputEl = document.getElementById("guessInput");
      const val = inputEl.value;
      const d = btn.getAttribute('data-digit');
      if (val.length >= 4 || val.includes(d)) return;
      inputEl.value = val + d;
      updateKeypad();
      inputEl.focus();
    });

    // é€€æ ¼èˆ‡æ¸…é™¤
    document.getElementById("btnBackspace").addEventListener("click", function() {
      const inputEl = document.getElementById("guessInput");
      inputEl.value = inputEl.value.slice(0, -1);
      updateKeypad();
      inputEl.focus();
    });
    document.getElementById("btnClear").addEventListener("click", function() {
      const inputEl = document.getElementById("guessInput");
      inputEl.value = "";
      updateKeypad();
      inputEl.focus();
    });

    // åˆå§‹åŒ–éŠæˆ²
    startNewGame();
    updateKeypad();
  </script>

  <!-- Bootstrap JS (åŒ…å« Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
